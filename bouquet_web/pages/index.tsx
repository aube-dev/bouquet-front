import Head from 'next/head';
import { useEffect, useState, useCallback, useMemo } from 'react';
import { useRecoilState } from 'recoil';
import styled from 'styled-components';

import LayoutWithNav from '../components/LayoutWithNav';
import { ProfilePic } from '../components/ProfilePic';
import PostMini from '../components/PostMini';

import { characterState } from '../features/atoms';

import * as Text from '../styles/TextStyles';

const TitleWrap = styled.div`
  display: flex;
  justify-content: space-between;

  width: 100%;
`;

type TitleProps = {
  scrolled: boolean;
}

function Title({ scrolled }: TitleProps) {
  const [character, setCharacter] = useRecoilState(characterState);

  const getProfilePicMediaQuery = useCallback(() => `
    @media (min-width: 320px) and (max-width: 519px) {
      width: ${scrolled ? 28 : 40}px;
      height: ${scrolled ? 28 : 40}px;
    }

    @media (min-width: 520px) {
      width: 40px;
      height: 40px;
    }
  `, [scrolled]);
  const profilePicMediaQuery = useMemo(() => getProfilePicMediaQuery(), [getProfilePicMediaQuery]);

  if (character.isLogined) {
    return (
      <TitleWrap>
        <span>
          <Text.Subtitle2B>
            {character.characterName}
          </Text.Subtitle2B>
          <Text.Subtitle2R>
            의<br />피드
          </Text.Subtitle2R>
        </span>
        <ProfilePic
          image={character.image}
          size={40}
          mediaQuery={profilePicMediaQuery}
        />
      </TitleWrap>
      )
  }
  else {
    return (
      <TitleWrap>
        <span>
          <Text.Subtitle2R>
            눈길이 가는
          </Text.Subtitle2R>
          <Text.Subtitle2B>
            <br />피드
          </Text.Subtitle2B>
        </span>
        <ProfilePic
          size={40}
          mediaQuery={profilePicMediaQuery}
        />
      </TitleWrap>
    )
  }
}

const Background = styled.div`
  width: 100%;
  height: 100%;
`;

export default function Home() {
  const [character, setCharacter] = useRecoilState(characterState);
  const [scrolled, setScrolled] = useState(false);

  useEffect(() => {
    setCharacter({
      isLogined: true,
      characterName: '단호좌현지',
      caption: '나는 나보다 약한 자의 말은 듣지 않는다',
      image: 'https://images.unsplash.com/photo-1626688226927-33257a21236f?ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&ixlib=rb-1.2.1&auto=format&fit=crop&w=1268&q=80',
    });
  }, [setCharacter]);

  const exampleData = [
    {
      character: character,
      text: 'Lorem ipsum dolor sit amet, consectetur adipiscing elit. Aliquam consectetur a arcu vitae vehicula. Curabitur tempus eros vitae neque placerat hendrerit. Cras interdum tellus sit amet eleifend varius. Praesent vitae nisi magna. Nunc fringilla porttitor sagittis. Nunc fringilla egestas sodales. Aenean finibus ipsum quis nibh rutrum suscipit. Integer varius mi ac arcu scelerisque, vitae tempus eros consectetur. Cras accumsan justo non eros consequat viverra. Vivamus mauris augue, vestibulum in iaculis vitae, condimentum eu erat. Morbi vitae dictum nulla, eu euismod nulla. Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos himenaeos. Proin tristique nisl augue, quis accumsan magna consectetur ut. Ut molestie volutpat faucibus. Etiam et velit commodo, consequat urna ac, semper felis. Sed non sapien lorem.',
      sunshine: 2500,
    },
    {
      character: character,
      text: 'Lorem ipsum dolor sit amet',
      sunshine: 2500,
    },
    {
      character: character,
      text: 'Lorem ipsum dolor sit amet',
      sunshine: 2500,
    },
    {
      character: character,
      text: 'Lorem ipsum dolor sit amet',
      sunshine: 2500,
    },
    {
      character: character,
      text: 'Lorem ipsum dolor sit amet',
      sunshine: 2500,
    },
    {
      character: character,
      text: 'Lorem ipsum dolor sit amet',
      sunshine: 2500,
    },
    {
      character: character,
      text: 'Lorem ipsum dolor sit amet',
      sunshine: 2500,
    },
    {
      character: character,
      text: 'Lorem ipsum dolor sit amet',
      sunshine: 2500,
    },
    {
      character: character,
      text: 'Lorem ipsum dolor sit amet',
      sunshine: 2500,
    },
    {
      character: character,
      text: 'Lorem ipsum dolor sit amet',
      sunshine: 2500,
    },
    {
      character: character,
      text: 'Lorem ipsum dolor sit amet',
      sunshine: 2500,
    },
  ]

  return (
    <Background>
      <Head>
        <title>홈</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>

      <LayoutWithNav
        topElement={<Title scrolled={scrolled} />}
        setScrolled={setScrolled}
      >
        {exampleData.map((data, idx) => (
          <PostMini
            character={data.character}
            text={data.text}
            sunshine={data.sunshine}
            key={idx}
          />
        ))}
      </LayoutWithNav>
    </Background>
  )
}